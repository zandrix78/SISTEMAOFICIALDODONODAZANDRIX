<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zandrix SaaS Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src='https://meet.jit.si/external_api.js'></script>
    <style>
        :root {
            --primary-color: #9d00ff; /* Roxo Neon */
            --primary-hover: #b24bf3;
            --bg-color: #000000; /* Preto Fundo */
            --card-bg: #0a0a0a; /* Preto um pouco mais claro */
            --text-color: #ffffff;
            --text-muted: #a0a0a0;
            --border-color: #333333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--card-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto; /* Permite rolar o menu se for muito grande */
            padding-bottom: 100px; /* Espa√ßo para os bot√µes de rolagem n√£o cobrirem o menu */
        }

        /* Estilo da Barra de Rolagem do Menu (Discreta) */
        .sidebar::-webkit-scrollbar { width: 4px; }
        .sidebar::-webkit-scrollbar-track { background: #000; }
        .sidebar::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        
        /* Particle Background */
        #particles-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .brand {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 40px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-align: center;
            text-shadow: 0 0 15px var(--primary-color), 0 0 30px var(--primary-color);
        }

        /* Profile Header in Sidebar */
        .profile-header {
            position: relative;
            margin-bottom: 20px;
            text-align: center;
        }
        .profile-banner {
            width: 100%;
            height: 80px;
            background-color: #222;
            border-radius: 8px 8px 0 0;
            background-size: cover;
            background-position: center;
        }
        .profile-logo {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 3px solid var(--primary-color);
            margin-top: -35px;
            background-color: #000;
            object-fit: cover;
            position: relative;
            z-index: 2;
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            padding: 15px;
            text-align: left;
            cursor: pointer;
            font-size: 16px;
            transition: 0.3s;
            border-radius: 8px;
            margin-bottom: 5px;
        }

        .nav-btn:hover, .nav-btn.active {
            background-color: rgba(157, 0, 255, 0.1);
            color: #fff;
            border-left: 3px solid var(--primary-color);
            box-shadow: 0 0 15px rgba(157, 0, 255, 0.2);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            height: 100vh; 
            height: 100dvh; /* Melhor ajuste para celular (barra de endere√ßo) */
            -webkit-overflow-scrolling: touch; /* Garante rolagem suave no iPhone/Android */
            padding-bottom: 100px; /* Espa√ßo extra no final para nada ficar escondido */
        }

        /* Estilo da Barra de Rolagem (Scrollbar) */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0a0a0a; 
        }
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color); 
            border-radius: 4px;
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        /* Cards & Inputs */
        .card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(157, 0, 255, 0.15);
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary-color);
            font-size: 14px;
            font-weight: bold;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            background-color: #000;
            border: 1px solid var(--border-color);
            color: white;
            border-radius: 5px;
            margin-bottom: 15px;
            transition: 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 5px var(--primary-color);
        }

        button.action-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        button.action-btn:hover {
            background-color: var(--primary-hover);
            box-shadow: 0 0 25px var(--primary-color);
        }

        /* Dashboard Specifics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(145deg, var(--card-bg), #1a1a1a);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 10px rgba(255,255,255,0.3);
        }

        .sales-list {
            list-style: none;
            margin-top: 10px;
        }

        .sales-list li {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            transition: background 0.2s;
        }
        .sales-list li:hover {
            background-color: rgba(157, 0, 255, 0.05);
        }

        /* Notes Layout */
        .notes-container {
            display: flex;
            gap: 20px;
            height: 60vh;
        }
        .notes-sidebar {
            width: 30%;
            overflow-y: auto;
            border-right: 1px solid var(--border-color);
            padding-right: 10px;
        }
        .note-editor {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .note-item {
            padding: 15px;
            cursor: pointer;
            border-bottom: 1px solid #222;
            transition: 0.3s;
            border-radius: 5px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.05);
            cursor: default;
        }
        .note-item:hover, .note-item.active {
            background: rgba(157,0,255,0.15);
            border-left: 3px solid var(--primary-color);
        }
        .note-title-preview {
            font-weight: bold;
            color: white;
        }
        .note-date {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Calculator */
        .calc-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 300px;
        }

        .calc-btn {
            padding: 20px;
            font-size: 18px;
            background-color: #222;
            color: white;
            border: 1px solid var(--border-color);
            cursor: pointer;
            border-radius: 5px;
            transition: 0.2s;
        }

        .calc-btn:hover {
            background-color: #333;
        }

        .calc-btn.operator {
            background-color: #330055;
            color: var(--primary-color);
        }

        .calc-btn.equal {
            background-color: var(--primary-color);
            grid-column: span 4;
            box-shadow: 0 0 15px var(--primary-color);
        }
        .calc-btn.equal:hover {
            background-color: var(--primary-hover);
            box-shadow: 0 0 25px var(--primary-hover);
        }

        #calc-display {
            grid-column: span 4;
            text-align: right;
            font-size: 24px;
            margin-bottom: 10px;
            background: #000;
        }

        /* Company Info Display */
        .company-header-info {
            margin-bottom: 20px;
            font-size: 14px;
            color: var(--text-muted);
        }
        .company-header-info span {
            margin-right: 15px;
            color: var(--primary-color);
        }

        /* Notifications */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .notification {
            background-color: var(--card-bg);
            border-left: 4px solid var(--primary-color);
            color: white;
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            animation: slideIn 0.5s ease-out forwards;
            min-width: 300px;
        }
        
        /* Employee Mode Specifics */
        .employee-badge {
            background: #333; color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 10px; vertical-align: middle; margin-left: 5px;
        }

        .notification.success { border-left-color: #00cc00; }
        .notification.error { border-left-color: #ff4444; }
        
        /* Mobile Support */
        #mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1001;
            background: var(--primary-color);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                height: 100vh;
                width: 85%;
                max-width: 300px;
                z-index: 1000;
                box-shadow: 5px 0 15px rgba(0,0,0,0.5);
                transition: left 0.3s ease;
            }

            .sidebar.active-mobile {
                left: 0;
            }

            .main-content {
                padding: 70px 20px 20px 20px;
            }

            #mobile-menu-btn {
                display: block;
            }

            .notes-container {
                flex-direction: column;
                height: auto;
            }
            .notes-sidebar {
                width: 100%;
                height: 200px;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                margin-bottom: 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .company-header-info {
                position: absolute;
                top: 20px;
                right: 20px;
                text-align: right;
                font-size: 11px;
            }
            .company-header-info span {
                display: block;
                margin: 0;
            }
        }

        /* Role based visibility */
        body.role-socio .owner-only {
            display: none !important;
        }
        body.role-socio .socio-only {
            display: block !important;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Project Status Badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-pending { background: #555; color: #ccc; }
        .status-dev { background: #0055aa; color: white; }
        .status-done { background: #008800; color: white; }

        /* Checklist Styles */
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #1a1a1a;
            margin-bottom: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.2s;
        }
        .checklist-item:hover { background: #252525; }
        .checklist-item.checked { opacity: 0.5; text-decoration: line-through; }
        .checklist-box {
            width: 20px; height: 20px; border: 2px solid var(--primary-color); margin-right: 10px; display: flex; align-items: center; justify-content: center;
        }
        .checklist-item.checked .checklist-box::after {
            content: '‚úî'; color: var(--primary-color); font-size: 14px;
        }

        /* Renewal Badges */
        .renewal-badge { padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; }
        .renewal-ok { background: #008800; color: white; }
        .renewal-warn { background: #ffcc00; color: black; }
        .renewal-late { background: #ff4444; color: white; }
        .renewal-days { font-size: 11px; color: #888; margin-left: 5px; }

        /* Scroll Controls (Desktop Only) */
        .scroll-controls {
            position: fixed;
            bottom: 30px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 999;
        }
        .scroll-btn {
            background: rgba(157, 0, 255, 0.6); color: white; border: 1px solid var(--primary-color); width: 50px; height: 50px; border-radius: 50%; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; backdrop-filter: blur(5px);
        }
        .scroll-btn:hover { background: var(--primary-color); box-shadow: 0 0 15px var(--primary-color); transform: scale(1.1); }
        
        @media (max-width: 768px) { .scroll-controls { display: none; } }

    </style>
</head>
<body>
    <canvas id="particles-canvas"></canvas>
    <div id="notification-container" class="notification-container"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="owner-sidebar">
        <div class="profile-header">
            <div id="sidebar-banner" class="profile-banner"></div>
            <img id="sidebar-logo" class="profile-logo" src="https://via.placeholder.com/150" style="display: none;">
        </div>
        <div class="brand" id="brand-display">ZANDRIX</div>
        
        <div id="owner-display-area" style="text-align: center; margin-bottom: 20px; display: none; animation: fadeIn 0.5s;">
            <img id="sidebar-owner-photo" style="width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--primary-color); object-fit: cover; margin-bottom: 5px;">
            <div id="sidebar-owner-name" style="font-size: 14px; color: white; font-weight: bold;"></div>
            <div style="font-size: 12px; color: var(--text-muted);">CEO / Fundador</div>
        </div>

        <button class="nav-btn active" onclick="showSection('dashboard')">üìä Dashboard</button>
        <button class="nav-btn" onclick="showSection('projects')">üöÄ Projetos</button>
        <button class="nav-btn" onclick="showSection('crm')">üë• Clientes (CRM)</button>
        <button class="nav-btn" onclick="showSection('meetings')">üìπ Reuni√µes</button>
        <button class="nav-btn" onclick="showSection('renewals')">üìÖ Renova√ß√µes</button>
        <button class="nav-btn" onclick="showSection('checklist')">‚úÖ Checklist</button>
        <button class="nav-btn" onclick="showSection('notes')">üìù Anota√ß√µes</button>
        <button class="nav-btn" onclick="showSection('invoices')">üßæ Recibos</button>
        <button class="nav-btn" onclick="showSection('contracts')">üìú Contratos</button>
        <button class="nav-btn" onclick="showSection('certificates')">üèÜ Certificados</button>
        <button class="nav-btn" onclick="showSection('calculator')">üßÆ Calculadora</button>
        <button class="nav-btn" onclick="showSection('financial')">üí∞ Financeiro</button>
        <button class="nav-btn" onclick="showSection('marketing')">üì¢ Marketing</button>
        <button class="nav-btn" onclick="showSection('settings')">üè¢ Perfil da Empresa</button>
    </div>

    <!-- Employee Sidebar (Hidden by default) -->
    <div class="sidebar" id="employee-sidebar" style="display: none;">
        <div class="brand">ZANDRIX <br><span style="font-size:12px; color:white;">√Årea da Equipe</span></div>
        
        <button class="nav-btn active" onclick="showSection('employee-dashboard')">üíº Vendas</button>
        <button class="nav-btn" onclick="showSection('projects')">üöÄ Projetos</button>
        <button class="nav-btn" onclick="showSection('meetings')">üìπ Reuni√µes</button>
        <button class="nav-btn" onclick="showSection('crm')">üë• Clientes (CRM)</button>
        <button class="nav-btn" onclick="showSection('marketing')">üì¢ Marketing</button>
        <button class="nav-btn" onclick="showSection('calculator')">üßÆ Calculadora</button>
        <button class="nav-btn" onclick="showSection('notes')">üìù Anota√ß√µes</button>
    </div>

    <!-- Socio Sidebar (Hidden by default) -->
    <div class="sidebar" id="socio-sidebar" style="display: none;">
        <div class="profile-header">
            <div id="socio-sidebar-banner" class="profile-banner"></div>
            <img id="socio-sidebar-logo" class="profile-logo" src="https://via.placeholder.com/150" style="display: none;">
        </div>
        <div class="brand" id="socio-brand-display">ZANDRIX <br><span style="font-size:12px; color:white;">√Årea de S√≥cio</span></div>
        
        <div id="socio-owner-display-area" style="text-align: center; margin-bottom: 20px; display: none; animation: fadeIn 0.5s;">
            <img id="socio-sidebar-owner-photo" style="width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--primary-color); object-fit: cover; margin-bottom: 5px;">
            <div id="socio-sidebar-owner-name" style="font-size: 14px; color: white; font-weight: bold;"></div>
            <div style="font-size: 12px; color: var(--text-muted);">CEO / Fundador</div>
        </div>

        <button class="nav-btn active" onclick="showSection('dashboard')">üìä Dashboard</button>
        <button class="nav-btn" onclick="showSection('projects')">üöÄ Projetos</button>
        <button class="nav-btn" onclick="showSection('crm')">üë• Clientes (CRM)</button>
        <button class="nav-btn" onclick="showSection('meetings')">üìπ Reuni√µes</button>
        <button class="nav-btn" onclick="showSection('renewals')">üìÖ Renova√ß√µes</button>
        <button class="nav-btn" onclick="showSection('notes')">üìù Anota√ß√µes</button>
        <button class="nav-btn" onclick="showSection('contracts')">üìú Contratos</button>
        <button class="nav-btn" onclick="showSection('calculator')">üßÆ Calculadora</button>
        <button class="nav-btn" onclick="showSection('financial')">üí∞ Financeiro</button>
        <button class="nav-btn" onclick="showSection('marketing')">üì¢ Marketing</button>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <button id="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
        
        <!-- Header Info -->
        <div class="company-header-info">
            <span id="header-insta">@zandrix</span>
            <span id="header-whats">WhatsApp: (00) 0000-0000</span>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <h2>Registrar Vendas</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <label>Total Vendido</label>
                    <div class="stat-value" id="total-sales">R$ 0.00</div>
                </div>
                <div class="stat-card">
                    <label>Vendas Hoje</label>
                    <div class="stat-value" id="today-sales">R$ 0.00</div>
                </div>
                <div class="stat-card">
                    <label>Vendas Semana</label>
                    <div class="stat-value" id="week-sales">R$ 0.00</div>
                </div>
                <div class="stat-card">
                    <label>Vendas M√™s</label>
                    <div class="stat-value" id="month-sales">R$ 0.00</div>
                </div>
                <div class="stat-card" style="border-left-color: #ff4444;">
                    <label style="color: #ff4444;">Total Despesas</label>
                    <div class="stat-value" id="total-expenses">R$ 0.00</div>
                </div>
                <div class="stat-card" style="border-left-color: #00cc00;">
                    <label style="color: #00cc00;">Lucro L√≠quido</label>
                    <div class="stat-value" id="net-profit">R$ 0.00</div>
                </div>
            </div>

            <div class="card">
                <label>Progresso da Meta Mensal</label>
                <div style="background-color: #222; border-radius: 10px; height: 25px; width: 100%; overflow: hidden; border: 1px solid var(--border-color); position: relative;">
                    <div id="goal-progress-bar" style="background-color: var(--primary-color); height: 100%; width: 0%; transition: width 0.5s; box-shadow: 0 0 10px var(--primary-color);"></div>
                    <div id="goal-text" style="position: absolute; top: 0; left: 0; width: 100%; text-align: center; line-height: 25px; font-size: 12px; font-weight: bold; text-shadow: 0 0 5px black; color: white;">0%</div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 12px; color: var(--text-muted);">
                    <span id="current-month-total">R$ 0.00</span>
                    <span id="goal-target">Meta: R$ 0.00</span>
                </div>
            </div>

            <div class="card">
                <label>Distribui√ß√£o de Vendas (Por Dia da Semana)</label>
                <div style="height: 300px; position: relative;">
                    <canvas id="salesChart"></canvas>
                </div>
            </div>

            <div class="card">
                <label>Comparativo: Vendas vs Despesas (√öltimos 6 Meses)</label>
                <div style="height: 300px; position: relative;">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>

            <div class="card">
                <label>Nova Venda (Valor)</label>
                <input type="number" id="sale-input" placeholder="Ex: 150.00">
                <button class="action-btn" onclick="addSale()">Registrar Venda</button>
            </div>

            <div class="card">
                <label>Hist√≥rico Recente</label>
                <ul class="sales-list" id="sales-history">
                    <!-- Lista preenchida via JS -->
                </ul>
            </div>
        </div>

        <!-- Projects Section (NEW) -->
        <div id="projects" class="section">
            <h2>Gest√£o de Projetos (Sites)</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <label>Projetos Ativos</label>
                    <div class="stat-value" id="active-projects-count">0</div>
                </div>
                <div class="stat-card" style="border-left-color: #0055aa;">
                    <label style="color: #0055aa;">Em Desenvolvimento</label>
                    <div class="stat-value" id="dev-projects-count">0</div>
                </div>
            </div>

            <div class="card">
                <label>Novo Projeto</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <input type="text" id="proj-client" placeholder="Nome do Cliente">
                    <input type="text" id="proj-name" placeholder="Tipo (Ex: Landing Page)">
                    <input type="number" id="proj-value" placeholder="Valor (R$)">
                    <input type="date" id="proj-deadline">
                </div>
                <select id="proj-status" style="width: 100%; padding: 12px; background: #000; color: white; border: 1px solid #333; border-radius: 5px; margin-bottom: 15px;">
                    <option value="pending">‚è≥ Pendente / Aguardando Info</option>
                    <option value="dev">üë®‚Äçüíª Em Desenvolvimento</option>
                    <option value="done">‚úÖ Conclu√≠do / Entregue</option>
                </select>
                <button class="action-btn" onclick="addProject()">‚ûï Adicionar Projeto</button>
            </div>

            <div class="card">
                <label>Lista de Projetos</label>
                <ul class="sales-list" id="projects-list">
                    <!-- Lista via JS -->
                </ul>
            </div>
        </div>

        <!-- Checklist Section (NEW) -->
        <div id="checklist" class="section">
            <h2>Checklist de Entrega (Go Live)</h2>
            <p style="color: var(--text-muted); margin-bottom: 20px;">Verifique estes itens antes de publicar o site do cliente.</p>
            
            <div class="card" id="checklist-container">
                <!-- Itens gerados via JS -->
            </div>
            <button class="action-btn" onclick="resetChecklist()" style="background: #333; font-size: 12px;">üîÑ Resetar Checklist</button>
        </div>

        <!-- Renewals Section (NEW) -->
        <div id="renewals" class="section">
            <h2>Renova√ß√µes (Hospedagem/Dom√≠nio)</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <label>Receita Recorrente (Mensal)</label>
                    <div class="stat-value" id="mrr-value">R$ 0.00</div>
                </div>
            </div>

            <div class="card">
                <label>Nova Renova√ß√£o</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <input type="text" id="ren-client" placeholder="Cliente">
                    <input type="text" id="ren-service" placeholder="Servi√ßo (Ex: Hospedagem)">
                    <input type="number" id="ren-value" placeholder="Valor (R$)">
                    <input type="date" id="ren-date">
                </div>
                <button class="action-btn" onclick="addRenewal()">‚ûï Agendar Renova√ß√£o</button>
            </div>

            <div class="card">
                <label>Pr√≥ximos Vencimentos</label>
                <ul class="sales-list" id="renewals-list"></ul>
            </div>
        </div>

        <!-- Invoices Section (NEW) -->
        <div id="invoices" class="section">
            <h2>Gerador de Recibos</h2>
            <div class="card">
                <label>Dados do Recibo</label>
                <input type="text" id="inv-client" placeholder="Nome do Cliente">
                <input type="text" id="inv-service" placeholder="Descri√ß√£o do Servi√ßo (Ex: Cria√ß√£o de Site Institucional)">
                <input type="number" id="inv-value" placeholder="Valor (R$)">
                <input type="date" id="inv-date">
                <button class="action-btn" onclick="generateInvoice()">üñ®Ô∏è Gerar e Imprimir Recibo</button>
            </div>
            <p style="color: #888; font-size: 12px;">* Isso abrir√° uma nova janela pronta para impress√£o ou salvar como PDF.</p>
        </div>

        <!-- Certificates Section (NEW) -->
        <div id="certificates" class="section">
            <h2>Gerador de Certificados (Reconhecimento)</h2>
            <div class="card">
                <label>Dados do Certificado</label>
                <input type="text" id="cert-name" placeholder="Nome do Premiado (Funcion√°rio/S√≥cio)">
                <input type="text" id="cert-reason" placeholder="Motivo (Ex: Meta de Vendas Batida, Funcion√°rio do M√™s)">
                <input type="date" id="cert-date">
                <button class="action-btn" onclick="generateCertificate()" style="background: linear-gradient(45deg, #9d00ff, #ff00dd);">üèÜ Gerar Certificado Oficial</button>
            </div>
            <p style="color: #888; font-size: 12px;">* Gera um certificado profissional com a logo da Zandrix pronto para imprimir.</p>
            <div class="card" style="margin-top: 20px; border: 1px solid #ffd700;">
                <label style="color: #ffd700;">√Årea do Dono</label>
                <p style="color: #ccc; font-size: 14px; margin-bottom: 10px;">Gerar certificado de honra para o CEO <strong>Richard da Silva Campos</strong>.</p>
                <button class="action-btn" onclick="generateOwnerCertificate()" style="background: linear-gradient(45deg, #ffd700, #b8860b); color: black; font-weight: bold;">üëë Gerar Certificado Supremo</button>
            </div>
        </div>

        <!-- CRM Section (NEW) -->
        <div id="crm" class="section">
            <h2>Gest√£o de Clientes (CRM)</h2>
            <div class="card">
                <label>Novo Cliente</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <input type="text" id="crm-name" placeholder="Nome do Cliente / Empresa">
                    <input type="text" id="crm-whats" placeholder="WhatsApp (apenas n√∫meros)">
                    <input type="text" id="crm-email" placeholder="Email">
                    <select id="crm-status">
                        <option value="lead">Prospect / Lead</option>
                        <option value="active">Cliente Ativo</option>
                        <option value="inactive">Inativo</option>
                    </select>
                </div>
                <button class="action-btn" onclick="addClient()">üíæ Salvar Cliente</button>
            </div>

            <div class="card">
                <label>Carteira de Clientes</label>
                <ul class="sales-list" id="crm-list">
                    <!-- Lista via JS -->
                </ul>
            </div>
        </div>

        <!-- Contracts Section (NEW) -->
        <div id="contracts" class="section">
            <h2>Gerador de Contratos</h2>
            <div class="card">
                <label>Dados do Contrato</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <input type="text" id="ctr-client" placeholder="Nome do Cliente / Raz√£o Social">
                    <input type="text" id="ctr-doc" placeholder="CPF ou CNPJ do Cliente">
                    <input type="text" id="ctr-service" placeholder="Descri√ß√£o do Servi√ßo (ex: Site Institucional)">
                    <input type="text" id="ctr-value" placeholder="Valor Total (R$)">
                    <input type="text" id="ctr-entry" placeholder="Valor da Entrada (R$)">
                    <input type="text" id="ctr-deadline" placeholder="Prazo de Entrega (dias)">
                </div>
                <button class="action-btn" onclick="generateContract()">üìÑ Gerar Contrato de Presta√ß√£o de Servi√ßos</button>
            </div>
        </div>

        <!-- Meetings Section (NEW) -->
        <div id="meetings" class="section">
            <h2>Sala de Reuni√µes Zandrix</h2>
            
            <!-- √Årea do Dono: Controle da Sala -->
            <div class="card owner-only" id="meeting-admin-panel">
                <label>Configura√ß√£o da Sala</label>
                <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Este √© o link √∫nico da reuni√£o. Envie para sua equipe. Eles colocar√£o o nome e foto ao entrar.</p>
                
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="text" id="meeting-url-display" readonly style="background: #111; color: var(--primary-color); font-weight: bold;">
                    <button class="action-btn" onclick="copyMeetingLink()" style="width: auto;">üîó Copiar</button>
                </div>

                <label style="color: #ff4444;">Seguran√ßa / Banimento</label>
                <p style="color: #aaa; font-size: 12px; margin-bottom: 10px;">Se precisar expulsar algu√©m ou impedir o acesso, gere uma nova sala. O link antigo deixar√° de funcionar imediatamente.</p>
                <button class="action-btn" onclick="generateNewMeetingRoom()" style="background: #ff4444;">üîÑ Gerar Nova Sala (Invalidar Link Antigo)</button>
            </div>

            <!-- √Årea de Perfil do Usu√°rio (Para todos personalizarem antes de entrar) -->
            <div class="card" id="meeting-lobby">
                <label>Seu Perfil para a Reuni√£o</label>
                <div style="display: flex; gap: 15px; align-items: center;">
                    <div style="text-align: center;">
                        <img id="meet-preview-avatar" src="https://i.imgur.com/w28Wu0f.png" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary-color);">
                        <button onclick="document.getElementById('meet-upload-avatar').click()" style="background: #333; border: none; color: white; font-size: 10px; padding: 5px; margin-top: 5px; cursor: pointer; border-radius: 3px;">üì∑ Trocar Foto</button>
                        <input type="file" id="meet-upload-avatar" accept="image/*" style="display: none;" onchange="updateMeetingAvatar(this)">
                    </div>
                    <div style="flex: 1;">
                        <label style="font-size: 12px; margin-bottom: 5px;">Seu Nome na Sala:</label>
                        <input type="text" id="meet-display-name" placeholder="Digite seu nome aqui...">
                    </div>
                </div>
                <button class="action-btn" onclick="startMeeting()" id="btn-join-meet" style="width: 100%; margin-top: 15px;">üé• Entrar na Reuni√£o</button>
            </div>

            <!-- √Årea de Reuni√£o (Para todos) -->
            <div class="card" id="meeting-active-area" style="display: none;">
                <label>Reuni√£o em Andamento</label>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <button class="action-btn" onclick="toggleScreenShare()" style="background: #0055aa; flex: 1;">üñ•Ô∏è Compartilhar Tela</button>
                    <button class="action-btn" onclick="leaveMeeting()" style="background: #333; flex: 1;">‚ùå Sair</button>
                </div>
                
                <!-- Container do Jitsi -->
                <div id="jitsi-container" style="width: 100%; height: 600px; background: #000; border-radius: 10px; border: 1px solid #333;">
                    <div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #666;">
                        Aguardando conex√£o...
                    </div>
                </div>
            </div>
        </div>

        <!-- Employee Dashboard (Simplified) -->
        <div id="employee-dashboard" class="section">
            <h2>√Årea do Funcion√°rio / Divulgador</h2>
            <p style="color: var(--text-muted); margin-bottom: 20px;">Registre suas vendas e utilize as ferramentas de marketing.</p>

            <div class="card">
                <label>Registrar Nova Venda</label>
                <input type="number" id="emp-sale-input" placeholder="Valor da Venda (R$)">
                <button class="action-btn" onclick="addSaleEmployee()">‚úÖ Confirmar Venda</button>
            </div>

            <div class="card">
                <label>Ferramentas R√°pidas</label>
                <button class="action-btn" onclick="showSection('marketing')" style="background: #333;">Ir para Gerador de Marketing</button>
            </div>
        </div>

        <!-- Notes Section -->
        <div id="notes" class="section">
            <h2>Anota√ß√µes da Empresa</h2>
            <div class="card notes-container">
                <div class="notes-sidebar" id="notes-list">
                    <!-- Lista de notas -->
                </div>
                <div class="note-editor">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button class="action-btn" onclick="saveNote()" style="background: #008800; flex: 1;">üíæ Salvar Nota</button>
                    </div>
                    <input type="text" id="note-title" placeholder="T√≠tulo da Nota">
                    <textarea id="note-content" style="flex: 1;" placeholder="Digite a descri√ß√£o da nota..."></textarea>
                </div>
            </div>
        </div>

        <!-- Calculator Section -->
        <div id="calculator" class="section">
            <h2>Calculadora R√°pida</h2>
            <div class="card" style="width: fit-content;">
                <input type="text" id="calc-display" readonly value="">
                <div class="calc-grid">
                    <button class="calc-btn" onclick="calcInput('7')">7</button>
                    <button class="calc-btn" onclick="calcInput('8')">8</button>
                    <button class="calc-btn" onclick="calcInput('9')">9</button>
                    <button class="calc-btn operator" onclick="calcInput('/')">/</button>
                    
                    <button class="calc-btn" onclick="calcInput('4')">4</button>
                    <button class="calc-btn" onclick="calcInput('5')">5</button>
                    <button class="calc-btn" onclick="calcInput('6')">6</button>
                    <button class="calc-btn operator" onclick="calcInput('*')">x</button>
                    
                    <button class="calc-btn" onclick="calcInput('1')">1</button>
                    <button class="calc-btn" onclick="calcInput('2')">2</button>
                    <button class="calc-btn" onclick="calcInput('3')">3</button>
                    <button class="calc-btn operator" onclick="calcInput('-')">-</button>
                    
                    <button class="calc-btn" onclick="calcInput('0')">0</button>
                    <button class="calc-btn" onclick="calcInput('.')">.</button>
                    <button class="calc-btn" onclick="backspaceCalc()">‚å´</button>
                    <button class="calc-btn" onclick="clearCalc()" style="color: red;">C</button>
                    <button class="calc-btn operator" onclick="calcInput('+')">+</button>
                    
                    <button class="calc-btn equal" onclick="calculate()">=</button>
                </div>
            </div>
        </div>

        <!-- Financial Section -->
        <div id="financial" class="section">
            <h2>Gest√£o Financeira</h2>
            
            <div class="stats-grid">
                <div class="stat-card" style="border-left-color: #00cc00;">
                    <label style="color: #00cc00;">Lucro L√≠quido Atual</label>
                    <div class="stat-value" id="fin-net-profit">R$ 0.00</div>
                </div>
                <div class="stat-card" style="border-left-color: #ff4444;">
                    <label style="color: #ff4444;">Total Gasto</label>
                    <div class="stat-value" id="fin-total-expenses">R$ 0.00</div>
                </div>
            </div>

            <div class="card">
                <label>Nova Despesa</label>
                <input type="text" id="expense-desc" placeholder="Descri√ß√£o (Ex: Aluguel, Internet, Fornecedor)">
                <input type="number" id="expense-value" placeholder="Valor (R$)">
                <button class="action-btn" onclick="addExpense()" style="background-color: #ff4444;">Registrar Despesa</button>
            </div>

            <div class="card">
                <label>Hist√≥rico de Despesas</label>
                <ul class="sales-list" id="expenses-list">
                    <!-- Lista de despesas -->
                </ul>
            </div>
        </div>

        <!-- Marketing Section -->
        <div id="marketing" class="section">
            <h2>Ideias de Marketing (Zandrix)</h2>
            <div class="card">
                <label>Gerador de Estrat√©gias para Web Design</label>
                <p style="color: var(--text-muted); margin-bottom: 15px;">Clique para receber uma ideia de como vender mais sites hoje.</p>
                <button class="action-btn" onclick="generateMarketingIdea()">üí° Gerar Ideia</button>
                
                <div id="marketing-result" style="margin-top: 20px; padding: 15px; background: #222; border-left: 4px solid var(--primary-color); display: none; border-radius: 5px;">
                    <h3 id="mkt-title" style="color: white; margin-bottom: 10px;"></h3>
                    <p id="mkt-desc" style="color: #ccc; font-size: 14px;"></p>
                </div>
            </div>

            <div class="card">
                <label>Gerador de Proposta R√°pida (WhatsApp)</label>
                <input type="text" id="prop-client-name" placeholder="Nome do Cliente">
                <input type="text" id="prop-price" placeholder="Valor (Ex: 800,00)">
                <button class="action-btn" onclick="generateProposal()">üìù Copiar Proposta</button>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings" class="section">
            <h2>Perfil da Empresa</h2>
            <div class="card">
                <label>Nome da Marca</label>
                <input type="text" id="conf-name" value="Zandrix">
                
                <label>Instagram</label>
                <input type="text" id="conf-insta" placeholder="@seuinsta">
                
                <label>WhatsApp</label>
                <input type="text" id="conf-whats" placeholder="(XX) XXXXX-XXXX">
                
                <label>Meta de Vendas Mensal (R$)</label>
                <input type="number" id="conf-goal" placeholder="Ex: 5000.00">

                <label>Nome do Dono / CEO</label>
                <input type="text" id="conf-owner-name" placeholder="Seu Nome">

                <label>Foto do Dono</label>
                <input type="file" id="conf-owner-photo" accept="image/*">
                <div style="margin-bottom: 15px;">
                    <img id="settings-owner-preview" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; display: none; border: 1px solid #333; margin-top: 5px;">
                </div>

                <label>Banner do Perfil</label>
                <input type="file" id="conf-banner-upload" accept="image/*">
                <div style="margin-bottom: 15px;">
                    <div id="settings-banner-preview" style="width: 100%; height: 60px; background: #222; background-size: cover; display: none; border-radius: 5px;"></div>
                </div>

                <label>Logo da Marca</label>
                <input type="file" id="conf-logo-upload" accept="image/*">
                <div style="margin-bottom: 15px;">
                    <img id="settings-logo-preview" style="max-width: 100px; display: none; border: 1px solid #333; margin-top: 5px;">
                </div>
                
                <button onclick="removeImages()" class="action-btn" style="padding: 5px 10px; font-size: 12px; background: #333; margin-bottom: 15px;">Remover Imagens</button>

                <label>Sincroniza√ß√£o (Backup / Restaurar)</label>
                <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 15px; background: rgba(255, 204, 0, 0.1); padding: 10px; border-radius: 5px; border-left: 3px solid #ffcc00; color: #ffcc00;">
                    ‚ö†Ô∏è <strong>Aten√ß√£o:</strong> Como este sistema n√£o usa servidor na nuvem, os dados ficam salvos <strong>apenas neste dispositivo</strong>. <br>Para transferir do Celular para o PC (ou vice-versa), clique em <strong>Exportar</strong> no dispositivo que tem os dados e depois em <strong>Importar</strong> no outro.
                </p>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="action-btn" onclick="document.getElementById('import-file').click()" style="background-color: #008800; flex: 1;">üì• Importar</button>
                    <button class="action-btn" onclick="exportData()" style="background-color: #333; flex: 1;">üì§ Exportar</button>
                </div>
                <input type="file" id="import-file" style="display: none;" onchange="importData(event)" accept=".json">

                <label>Seguran√ßa da Equipe</label>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="text" id="conf-token" readonly style="margin-bottom: 0; background: #111; color: #888; font-family: monospace;" title="Token atual">
                    <button class="action-btn" onclick="generateNewToken()" style="background-color: #550099; width: auto; padding: 12px;">üîÑ Trocar Link</button>
                </div>

                <label>Acesso da Equipe</label>
                <button class="action-btn" onclick="copyEmployeeLink()" style="background-color: #333; margin-bottom: 15px;">üîó Copiar Link para Funcion√°rios</button>

                <label>Seguran√ßa dos S√≥cios</label>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="text" id="conf-socio-token" readonly style="margin-bottom: 0; background: #111; color: #888; font-family: monospace;" title="Token de S√≥cio atual">
                    <button class="action-btn" onclick="generateNewSocioToken()" style="background-color: #550099; width: auto; padding: 12px;">üîÑ Trocar Link</button>
                </div>

                <label>Acesso dos S√≥cios</label>
                <button class="action-btn" onclick="copySocioLink()" style="background-color: #333; margin-bottom: 15px;">üîó Copiar Link para S√≥cios</button>

                <button class="action-btn" onclick="saveSettings()">Salvar Altera√ß√µes</button>
            </div>
        </div>

    </div>

    <!-- Scroll Controls -->
    <div class="scroll-controls">
        <button class="scroll-btn" onclick="scrollPage('up')">‚ñ≤</button>
        <button class="scroll-btn" onclick="scrollPage('down')">‚ñº</button>
    </div>

    <script>
        // --- Navega√ß√£o ---
        function showSection(sectionId) {
            // Esconde todas as se√ß√µes
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            // Mostra a selecionada
            document.getElementById(sectionId).classList.add('active');
            
            // Atualiza bot√£o ativo
            document.querySelectorAll(`.nav-btn[onclick="showSection('${sectionId}')"]`).forEach(btn => btn.classList.add('active'));
            
            // Fecha menu mobile ao clicar
            if(window.innerWidth <= 768) {
                document.querySelectorAll('.sidebar').forEach(s => s.classList.remove('active-mobile'));
            }
        }

        function toggleSidebar() {
            const s1 = document.getElementById('owner-sidebar');
            const s2 = document.getElementById('employee-sidebar');
            const s3 = document.getElementById('socio-sidebar');
            
            if (s2.style.display === 'flex') {
                s2.classList.toggle('active-mobile');
            } else if (s3.style.display === 'flex') {
                s3.classList.toggle('active-mobile');
            } else {
                s1.classList.toggle('active-mobile');
            }
        }

        // --- L√≥gica de Vendas ---
        let sales = JSON.parse(localStorage.getItem('zandrix_sales')) || [];
        let expenses = JSON.parse(localStorage.getItem('zandrix_expenses')) || [];
        let salesChartInstance = null;
        let comparisonChartInstance = null;
        let goalReached = false;

        function updateDashboard() {
            const list = document.getElementById('sales-history');
            list.innerHTML = '';
            
            let total = 0;
            let todayTotal = 0;
            let weekTotal = 0;
            let monthTotal = 0;
            let salesByDay = [0, 0, 0, 0, 0, 0, 0]; // Dom - Sab

            const now = new Date();
            const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1).getTime();
            
            // Come√ßo da semana (Domingo)
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay());
            startOfWeek.setHours(0,0,0,0);
            const startOfWeekTime = startOfWeek.getTime();

            // Processar vendas
            sales.slice().reverse().forEach(sale => {
                const val = parseFloat(sale.value);
                const saleTime = sale.id; // ID √© o timestamp
                const saleDate = new Date(saleTime);

                total += val;
                if (saleTime >= startOfDay) todayTotal += val;
                if (saleTime >= startOfWeekTime) weekTotal += val;
                if (saleTime >= startOfMonth) monthTotal += val;
                
                // Dados para o gr√°fico
                salesByDay[saleDate.getDay()] += val;

                // Lista (apenas as ultimas 10)
                if (list.children.length < 10) {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${sale.date} - <span style="color:var(--primary-color)">R$ ${parseFloat(sale.value).toFixed(2)}</span></span>
                    <button onclick="deleteSale(${sale.id})" style="background: transparent; border: none; cursor: pointer; font-size: 14px; color: #ff4444;">‚ùå Excluir</button>
                `;
                list.appendChild(li);
                }
            });

            document.getElementById('total-sales').innerText = `R$ ${total.toFixed(2)}`;
            document.getElementById('today-sales').innerText = `R$ ${todayTotal.toFixed(2)}`;
            document.getElementById('week-sales').innerText = `R$ ${weekTotal.toFixed(2)}`;
            document.getElementById('month-sales').innerText = `R$ ${monthTotal.toFixed(2)}`;

            // L√≥gica de Despesas e Lucro
            let totalExpenses = expenses.reduce((acc, curr) => acc + curr.value, 0);
            let netProfit = total - totalExpenses;

            document.getElementById('total-expenses').innerText = `R$ ${totalExpenses.toFixed(2)}`;
            const profitEl = document.getElementById('net-profit');
            profitEl.innerText = `R$ ${netProfit.toFixed(2)}`;
            profitEl.style.color = netProfit >= 0 ? '#00cc00' : '#ff4444';

            // Atualiza aba Financeiro
            document.getElementById('fin-net-profit').innerText = `R$ ${netProfit.toFixed(2)}`;
            document.getElementById('fin-total-expenses').innerText = `R$ ${totalExpenses.toFixed(2)}`;

            // L√≥gica da Meta
            const settings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};
            const goal = parseFloat(settings.goal) || 0;
            
            document.getElementById('current-month-total').innerText = `R$ ${monthTotal.toFixed(2)}`;
            document.getElementById('goal-target').innerText = `Meta: R$ ${goal.toFixed(2)}`;

            if (goal > 0) {
                const percent = Math.min((monthTotal / goal) * 100, 100);
                document.getElementById('goal-progress-bar').style.width = `${percent}%`;
                document.getElementById('goal-text').innerText = `${percent.toFixed(1)}%`;
                
                if (monthTotal >= goal && !goalReached) {
                    showNotification(`üéâ Parab√©ns! Meta de R$ ${goal.toFixed(2)} atingida!`, 'success');
                    goalReached = true;
                } else if (monthTotal < goal) {
                    goalReached = false;
                }
            } else {
                document.getElementById('goal-progress-bar').style.width = `0%`;
                document.getElementById('goal-text').innerText = `Sem meta definida`;
            }
            
            renderChart(salesByDay);
            
            // --- Dados para o Gr√°fico Comparativo (√öltimos 6 Meses) ---
            const monthsLabels = [];
            const salesMonthly = [0, 0, 0, 0, 0, 0];
            const expensesMonthly = [0, 0, 0, 0, 0, 0];
            
            for(let i=5; i>=0; i--) {
                const d = new Date();
                d.setMonth(d.getMonth() - i);
                const monthName = d.toLocaleDateString('pt-BR', { month: 'short' }).replace('.', '').toUpperCase();
                monthsLabels.push(`${monthName}/${d.getFullYear().toString().slice(2)}`);
            }

            const getMonthIndex = (timestamp) => {
                const date = new Date(timestamp);
                const today = new Date();
                const diff = (today.getFullYear() - date.getFullYear()) * 12 + (today.getMonth() - date.getMonth());
                return 5 - diff;
            };

            sales.forEach(s => {
                const idx = getMonthIndex(s.id);
                if(idx >= 0 && idx <= 5) salesMonthly[idx] += parseFloat(s.value);
            });

            expenses.forEach(e => {
                const idx = getMonthIndex(e.id);
                if(idx >= 0 && idx <= 5) expensesMonthly[idx] += parseFloat(e.value);
            });

            renderComparisonChart(monthsLabels, salesMonthly, expensesMonthly);
        }

        function renderChart(data) {
            const ctx = document.getElementById('salesChart').getContext('2d');
            
            if (salesChartInstance) {
                salesChartInstance.destroy();
            }

            salesChartInstance = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'],
                    datasets: [{
                        label: 'Vendas',
                        data: data,
                        backgroundColor: [
                            '#330055', '#440077', '#550099', '#6600bb', '#7700dd', '#8800ff', '#9d00ff'
                        ],
                        borderColor: '#000000',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { color: 'white' } }
                    }
                }
            });
        }

        function renderComparisonChart(labels, salesData, expensesData) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');

            if (comparisonChartInstance) {
                comparisonChartInstance.destroy();
            }

            comparisonChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Vendas',
                            data: salesData,
                            backgroundColor: '#9d00ff',
                            borderColor: '#9d00ff',
                            borderWidth: 1
                        },
                        {
                            label: 'Despesas',
                            data: expensesData,
                            backgroundColor: '#ff4444',
                            borderColor: '#ff4444',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#333' }, ticks: { color: '#a0a0a0' } },
                        x: { grid: { display: false }, ticks: { color: '#a0a0a0' } }
                    },
                    plugins: { legend: { labels: { color: 'white' } } }
                }
            });
        }

        function addSale() {
            const input = document.getElementById('sale-input');
            const value = input.value;
            
            if(value && value > 0) {
                const newSale = {
                    id: Date.now(),
                    value: value,
                    date: new Date().toLocaleDateString('pt-BR') + ' ' + new Date().toLocaleTimeString('pt-BR')
                };
                sales.push(newSale);
                localStorage.setItem('zandrix_sales', JSON.stringify(sales));
                input.value = '';
                updateDashboard();
            } else {
                showNotification("Por favor, insira um valor v√°lido.", 'error');
            }
        }

        function addSaleEmployee() {
            const input = document.getElementById('emp-sale-input');
            const value = input.value;
            
            if(value && value > 0) {
                const newSale = {
                    id: Date.now(),
                    value: value,
                    date: new Date().toLocaleDateString('pt-BR') + ' ' + new Date().toLocaleTimeString('pt-BR') + ' (Func.)'
                };
                sales.push(newSale);
                localStorage.setItem('zandrix_sales', JSON.stringify(sales));
                input.value = '';
                showNotification("Venda registrada com sucesso!", "success");
            } else {
                showNotification("Insira um valor v√°lido.", "error");
            }
        }

        function deleteSale(id) {
            if(confirm("Tem certeza que deseja excluir esta venda?")) {
                sales = sales.filter(s => s.id !== id);
                localStorage.setItem('zandrix_sales', JSON.stringify(sales));
                updateDashboard();
            }
        }

        // --- L√≥gica de Anota√ß√µes ---
        let notes = JSON.parse(localStorage.getItem('zandrix_notes_v2')) || [];
        let activeNoteId = null;

        function loadNotes() {
            const list = document.getElementById('notes-list');
            list.innerHTML = '';
            
            notes.forEach(note => {
                const div = document.createElement('div');
                div.className = `note-item`;
                div.innerHTML = `
                    <div style="flex:1;">
                        <div class="note-title-preview">${note.title || 'Sem T√≠tulo'}</div>
                        <div class="note-date">${new Date(note.id).toLocaleDateString()}</div>
                    </div>
                    <div style="display:flex; gap:5px;">
                        <button onclick="viewNote(${note.id})" style="background:var(--primary-color); border:none; color:white; padding:5px 10px; border-radius:3px; cursor:pointer; font-size:12px;">üëÅÔ∏è Visualizar</button>
                        <button onclick="deleteNote(${note.id})" style="background:#ff4444; border:none; color:white; padding:5px 10px; border-radius:3px; cursor:pointer; font-size:12px;">üóëÔ∏è</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function viewNote(id) {
            activeNoteId = id;
            const note = notes.find(n => n.id === id);
            if (note) {
                document.getElementById('note-title').value = note.title;
                document.getElementById('note-content').value = note.content;
                showNotification("Nota carregada para visualiza√ß√£o/edi√ß√£o.", "info");
            }
        }

        function saveNote() {
            const title = document.getElementById('note-title').value;
            const content = document.getElementById('note-content').value;
            
            if (!title && !content) {
                showNotification("A nota precisa de t√≠tulo ou conte√∫do.", "error");
                return;
            }

            if (activeNoteId) {
                // Atualizar existente
                const note = notes.find(n => n.id === activeNoteId);
                if (note) {
                    note.title = title;
                    note.content = content;
                }
                activeNoteId = null; // Reseta para modo "Nova Nota" ap√≥s salvar edi√ß√£o
            } else {
                // Criar nova
                const newNote = {
                    id: Date.now(),
                    title: title || 'Sem T√≠tulo',
                    content: content
                };
                notes.unshift(newNote);
            }
            
            localStorage.setItem('zandrix_notes_v2', JSON.stringify(notes));
            
            // Limpar campos
            document.getElementById('note-title').value = '';
            document.getElementById('note-content').value = '';
            
            loadNotes();
            showNotification("Nota salva com sucesso!", "success");
        }

        function deleteNote(id) {
            if (confirm('Tem certeza que deseja apagar esta nota?')) {
                notes = notes.filter(n => n.id !== id);
                localStorage.setItem('zandrix_notes_v2', JSON.stringify(notes));
                
                // Se estava editando a nota exclu√≠da, limpa o editor
                if (activeNoteId === id) {
                    document.getElementById('note-title').value = '';
                    document.getElementById('note-content').value = '';
                    activeNoteId = null;
                }
                
                loadNotes();
                showNotification("Nota exclu√≠da.", "success");
            }
        }

        // --- L√≥gica de Despesas ---
        function addExpense() {
            const descInput = document.getElementById('expense-desc');
            const valInput = document.getElementById('expense-value');
            const desc = descInput.value;
            const val = parseFloat(valInput.value);

            if (desc && val && val > 0) {
                const newExpense = {
                    id: Date.now(),
                    desc: desc,
                    value: val,
                    date: new Date().toLocaleDateString('pt-BR')
                };
                expenses.push(newExpense);
                localStorage.setItem('zandrix_expenses', JSON.stringify(expenses));
                descInput.value = '';
                valInput.value = '';
                updateExpensesList();
                updateDashboard();
            } else {
                showNotification("Preencha a descri√ß√£o e um valor v√°lido.", 'error');
            }
        }

        function deleteExpense(id) {
            if(confirm("Excluir despesa?")) {
                expenses = expenses.filter(e => e.id !== id);
                localStorage.setItem('zandrix_expenses', JSON.stringify(expenses));
                updateExpensesList();
                updateDashboard();
            }
        }

        function updateExpensesList() {
            const list = document.getElementById('expenses-list');
            list.innerHTML = '';
            expenses.slice().reverse().forEach(exp => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${exp.date} - ${exp.desc}</span>
                    <span>
                        <span style="color: #ff4444; margin-right: 10px;">- R$ ${exp.value.toFixed(2)}</span>
                        <button onclick="deleteExpense(${exp.id})" style="background: transparent; border: none; cursor: pointer; font-size: 14px; color: #ff4444;">‚ùå</button>
                    </span>
                `;
                list.appendChild(li);
            });
        }

        // --- L√≥gica de Marketing ---
        function generateMarketingIdea() {
            const actions = [
                "Ofere√ßa uma auditoria gratuita",
                "Crie uma Landing Page demo",
                "Mande um √°udio no Direct",
                "Fa√ßa um v√≠deo de an√°lise de tela",
                "Visite pessoalmente",
                "Busque no Google Maps",
                "Entre em contato pelo WhatsApp",
                "Fa√ßa parceria com contadores",
                "Use o LinkedIn"
            ];
            const niches = [
                "de Pizzarias/Delivery",
                "de Advogados",
                "de Dentistas",
                "de Imobili√°rias",
                "de Academias/Crossfit",
                "de Pet Shops",
                "de Cl√≠nicas de Est√©tica",
                "de Oficinas Mec√¢nicas",
                "de Lojas de Roupa",
                "de Arquitetos"
            ];
            const strategies = [
                "focando na velocidade do site mobile.",
                "mostrando que o concorrente est√° na frente no Google.",
                "oferecendo um bot√£o de WhatsApp flutuante.",
                "prometendo entregar a primeira vers√£o em 48 horas.",
                "mostrando como eles perdem clientes sem site profissional.",
                "oferecendo a primeira mensalidade de manuten√ß√£o gr√°tis.",
                "focando em agendamento online autom√°tico.",
                "criando um QR Code para o card√°pio/servi√ßos.",
                "melhorando a ficha do Google Meu Neg√≥cio.",
                "integrando com o Instagram Shopping."
            ];

            const randomAction = actions[Math.floor(Math.random() * actions.length)];
            const randomNiche = niches[Math.floor(Math.random() * niches.length)];
            const randomStrategy = strategies[Math.floor(Math.random() * strategies.length)];

            const resDiv = document.getElementById('marketing-result');
            document.getElementById('mkt-title').innerText = "Nova Estrat√©gia Gerada:";
            document.getElementById('mkt-desc').innerText = `${randomAction} para donos ${randomNiche} ${randomStrategy}`;
            resDiv.style.display = 'block';
        }

        function generateProposal() {
            const name = document.getElementById('prop-client-name').value || "Cliente";
            const price = document.getElementById('prop-price').value || "0,00";
            
            const text = `Ol√° ${name}, tudo bem? üëã\n\nAqui √© da Zandrix! Analisei seu perfil e vi que podemos transformar seus resultados com um Site Profissional.\n\nüöÄ *O que est√° incluso:*\n- Design Moderno e Responsivo (Celular/PC)\n- Bot√£o de WhatsApp Integrado\n- Otimiza√ß√£o para o Google (SEO)\n\nüí∞ *Investimento Especial:* De ~R$ 1.500~ por apenas *R$ ${price}* (Pagamento √∫nico).\n\nPodemos agendar o in√≠cio?`;
            
            navigator.clipboard.writeText(text).then(() => {
                showNotification("Proposta copiada! Cole no WhatsApp.", "success");
            });
        }

        // --- L√≥gica de Renova√ß√µes (NOVO) ---
        let renewals = JSON.parse(localStorage.getItem('zandrix_renewals')) || [];

        function loadRenewals() {
            const list = document.getElementById('renewals-list');
            list.innerHTML = '';
            let mrr = 0;

            // Ordenar por data
            renewals.sort((a, b) => new Date(a.date) - new Date(b.date));

            renewals.forEach(r => {
                mrr += parseFloat(r.value);
                const li = document.createElement('li');
                
                // Calcular dias restantes
                const today = new Date();
                const due = new Date(r.date);
                const diffTime = due - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 

                let badgeClass = 'renewal-ok';
                let badgeText = 'Em dia';
                
                if (diffDays < 0) { badgeClass = 'renewal-late'; badgeText = 'ATRASADO'; }
                else if (diffDays <= 7) { badgeClass = 'renewal-warn'; badgeText = 'Vence Logo'; }

                li.innerHTML = `
                    <div style="flex:1">
                        <div style="font-weight:bold; color:white;">${r.client} <span class="renewal-badge ${badgeClass}">${badgeText}</span></div>
                        <div style="font-size:12px; color:#aaa;">${r.service} - R$ ${parseFloat(r.value).toFixed(2)} <span class="renewal-days">(${diffDays} dias)</span></div>
                    </div>
                    <div style="display:flex; align-items:center; gap: 10px;">
                        <div style="font-size:12px; color:white;">${new Date(r.date).toLocaleDateString()}</div>
                        <button onclick="deleteRenewal(${r.id})" style="background:none; border:none; cursor:pointer;">üóëÔ∏è</button>
                    </div>
                `;
                list.appendChild(li);
            });

            document.getElementById('mrr-value').innerText = `R$ ${mrr.toFixed(2)}`;
        }

        function addRenewal() {
            const client = document.getElementById('ren-client').value;
            const service = document.getElementById('ren-service').value;
            const value = document.getElementById('ren-value').value;
            const date = document.getElementById('ren-date').value;

            if(client && value && date) {
                renewals.push({ id: Date.now(), client, service, value, date });
                localStorage.setItem('zandrix_renewals', JSON.stringify(renewals));
                
                document.getElementById('ren-client').value = '';
                document.getElementById('ren-service').value = '';
                document.getElementById('ren-value').value = '';
                
                loadRenewals();
                showNotification("Renova√ß√£o agendada!", "success");
            } else {
                showNotification("Preencha todos os campos.", "error");
            }
        }

        function deleteRenewal(id) {
            if(confirm("Remover esta renova√ß√£o?")) {
                renewals = renewals.filter(r => r.id !== id);
                localStorage.setItem('zandrix_renewals', JSON.stringify(renewals));
                loadRenewals();
            }
        }

        // --- L√≥gica de Recibos (NOVO) ---
        function generateInvoice() {
            const client = document.getElementById('inv-client').value;
            const service = document.getElementById('inv-service').value;
            const value = document.getElementById('inv-value').value;
            const date = document.getElementById('inv-date').value;
            const settings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};
            const myName = settings.name || "Zandrix Agency";

            if(!client || !value) return showNotification("Preencha cliente e valor.", "error");

            const win = window.open('', '', 'width=800,height=600');
            win.document.write(`
                <html><head><title>Recibo</title><style>body{font-family:sans-serif;padding:40px;max-width:700px;margin:0 auto;border:1px solid #ccc;margin-top:20px;} .header{text-align:center;margin-bottom:40px;border-bottom:2px solid #000;padding-bottom:20px;} h1{margin:0;} .row{display:flex;justify-content:space-between;margin-bottom:15px;} .box{background:#f0f0f0;padding:20px;margin:20px 0;} .footer{margin-top:50px;text-align:center;font-size:12px;}</style></head><body>
                <div class="header"><h1>RECIBO DE PAGAMENTO</h1><p>${myName}</p></div>
                <div class="row"><strong>Data:</strong> <span>${new Date(date || Date.now()).toLocaleDateString()}</span></div>
                <div class="row"><strong>Cliente:</strong> <span>${client}</span></div>
                <div class="box">
                    <p>Recebemos a import√¢ncia de <strong>R$ ${parseFloat(value).toFixed(2)}</strong></p>
                    <p>Referente a: ${service}</p>
                </div>
                <div class="footer"><p>__________________________________<br>Assinatura / ${myName}</p></div>
                <script>window.print();<\/script>
                </body></html>
            `);
        }

        // --- L√≥gica de Certificados (NOVO) ---
        function printCertificate(name, reason, date, signerName) {
            const logoUrl = 'https://i.imgur.com/w28Wu0f.png';
            const win = window.open('', '', 'width=900,height=650');
            win.document.write(`
                <html>
                <head>
                    <title>Certificado - Zandrix</title>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Dancing+Script&family=Montserrat:wght@300;400&display=swap');
                        * { box-sizing: border-box; }
                        body { margin: 0; padding: 0; background: #f0f0f0; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Montserrat', sans-serif; }
                        .certificate {
                            width: 800px; height: 550px; background: #fff; padding: 20px;
                            border: 10px solid #9d00ff;
                            position: relative; text-align: center; box-shadow: 0 0 20px rgba(0,0,0,0.2);
                            background-image: radial-gradient(circle at center, rgba(157, 0, 255, 0.03) 0%, rgba(255,255,255,1) 70%);
                        }
                        .inner-border {
                            border: 2px solid #333; height: 100%; width: 100%; box-sizing: border-box; position: relative;
                            display: flex; flex-direction: column; justify-content: center; align-items: center;
                            padding: 15px;
                        }
                        .logo { width: 60px; margin-bottom: 5px; }
                        h1 { font-family: 'Cinzel', serif; font-size: 36px; color: #333; margin: 5px 0; text-transform: uppercase; letter-spacing: 4px; }
                        .subtitle { font-size: 14px; color: #666; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px; }
                        .present-to { font-size: 14px; color: #888; margin-bottom: 5px; font-style: italic; }
                        .name { font-family: 'Cinzel', serif; font-size: 42px; font-weight: 700; color: #9d00ff; margin: 5px 0 15px 0; border-bottom: 1px solid #ddd; padding: 0 30px; display: inline-block; text-shadow: 1px 1px 0px rgba(0,0,0,0.1); }
                        .reason { font-size: 16px; color: #444; max-width: 80%; line-height: 1.3; margin-bottom: 15px; }
                        .footer { display: flex; justify-content: space-around; width: 100%; margin-top: 15px; }
                        .sig-line { border-top: 1px solid #333; width: 200px; padding-top: 10px; font-weight: bold; color: #333; }
                        .date { font-size: 14px; color: #666; }
                        .signature { font-family: 'Dancing Script', cursive; font-size: 32px; color: #000; margin-bottom: 0px; }
                        @media print {
                            body { background: none; -webkit-print-color-adjust: exact; }
                            .certificate { box-shadow: none; margin: 0; page-break-inside: avoid; }
                        }
                    </style>
                </head>
                <body>
                    <div class="certificate">
                        <div class="inner-border">
                            <img src="${logoUrl}" class="logo" alt="Zandrix Logo">
                            <h1>Certificado</h1>
                            <div class="subtitle">de Reconhecimento</div>
                            <div class="present-to">Este certificado √© orgulhosamente concedido a</div>
                            <div class="name">${name}</div>
                            <div class="reason">Por sua dedica√ß√£o e excelente desempenho ao alcan√ßar:<br><strong>${reason}</strong></div>
                            <div class="footer">
                                <div><div class="date">${new Date(date || Date.now()).toLocaleDateString()}</div><div class="sig-line">Data</div></div>
                                <div><div class="signature">${signerName}</div><div class="sig-line">Assinatura</div></div>
                            </div>
                        </div>
                    </div>
                    <script>setTimeout(() => { window.print(); }, 1000);<\/script>
                </body>
                </html>
            `);
        }

        function generateCertificate() {
            const name = document.getElementById('cert-name').value;
            const reason = document.getElementById('cert-reason').value;
            const date = document.getElementById('cert-date').value;
            const settings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};
            const ownerName = settings.ownerName || "CEO Zandrix";

            if(!name || !reason) return showNotification("Preencha nome e motivo.", "error");
            printCertificate(name, reason, date, ownerName);
        }

        function generateOwnerCertificate() {
            printCertificate("Richard da Silva Campos", "Excel√™ncia em Lideran√ßa e Vis√£o Estrat√©gica", new Date().toISOString().split('T')[0], "Equipe Zandrix");
        }

        // --- L√≥gica de CRM (NOVO) ---
        let clients = JSON.parse(localStorage.getItem('zandrix_clients')) || [];

        function loadClients() {
            const list = document.getElementById('crm-list');
            list.innerHTML = '';
            
            clients.forEach(c => {
                const li = document.createElement('li');
                let statusColor = '#888';
                let statusText = 'Inativo';
                if(c.status === 'lead') { statusColor = '#ffcc00'; statusText = 'Lead'; }
                if(c.status === 'active') { statusColor = '#00cc00'; statusText = 'Ativo'; }

                li.innerHTML = `
                    <div style="flex:1">
                        <div style="font-weight:bold; color:white;">${c.name} <span style="font-size:10px; background:${statusColor}; color:black; padding:2px 5px; border-radius:3px;">${statusText}</span></div>
                        <div style="font-size:12px; color:#aaa;">
                            ${c.whats ? `<a href="https://wa.me/55${c.whats}" target="_blank" style="color:var(--primary-color); text-decoration:none;">üì± WhatsApp</a>` : ''} 
                            ${c.email ? `| üìß ${c.email}` : ''}
                        </div>
                    </div>
                    <button onclick="deleteClient(${c.id})" style="background:none; border:none; cursor:pointer;">üóëÔ∏è</button>
                `;
                list.appendChild(li);
            });
        }

        function addClient() {
            const name = document.getElementById('crm-name').value;
            const whats = document.getElementById('crm-whats').value;
            const email = document.getElementById('crm-email').value;
            const status = document.getElementById('crm-status').value;

            if(name) {
                clients.push({ id: Date.now(), name, whats, email, status });
                localStorage.setItem('zandrix_clients', JSON.stringify(clients));
                
                document.getElementById('crm-name').value = '';
                document.getElementById('crm-whats').value = '';
                document.getElementById('crm-email').value = '';
                
                loadClients();
                showNotification("Cliente salvo!", "success");
            } else {
                showNotification("Nome √© obrigat√≥rio.", "error");
            }
        }

        function deleteClient(id) {
            if(confirm("Remover cliente?")) {
                clients = clients.filter(c => c.id !== id);
                localStorage.setItem('zandrix_clients', JSON.stringify(clients));
                loadClients();
            }
        }

        // --- L√≥gica de Reuni√µes (NOVO) ---
        let jitsiApi = null;

        function loadMeetingSettings() {
            const settings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};
            
            // Se n√£o tiver ID de sala, cria um
            if (!settings.meetingRoomId) {
                settings.meetingRoomId = 'ZandrixRoom_' + Math.random().toString(36).substring(2, 10);
                localStorage.setItem('zandrix_settings', JSON.stringify(settings));
            }

            // Monta o link
            const link = `${window.location.href.split('?')[0]}?meetingId=${settings.meetingRoomId}`;
            document.getElementById('meeting-url-display').value = link;
        }

        function generateNewMeetingRoom() {
            if(confirm("Tem certeza? Isso vai expulsar todos da sala atual e o link antigo deixar√° de funcionar.")) {
                const settings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};
                settings.meetingRoomId = 'ZandrixMeet' + Date.now();
                localStorage.setItem('zandrix_settings', JSON.stringify(settings));
                
                loadMeetingSettings();
                showNotification("Nova sala gerada! Envie o novo link.", "success");
            }
        }

        function copyMeetingLink() {
            const link = document.getElementById('meeting-url-display').value;
            navigator.clipboard.writeText(link).then(() => showNotification("Link copiado!", "success"));
        }

        // Fun√ß√£o para atualizar avatar da reuni√£o
        let currentMeetingAvatar = "";
        function updateMeetingAvatar(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentMeetingAvatar = e.target.result;
                    document.getElementById('meet-preview-avatar').src = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function startMeeting() {
            const container = document.getElementById('jitsi-container');
            const lobby = document.getElementById('meeting-lobby');
            const activeArea = document.getElementById('meeting-active-area');
            const settings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};
            
            // Pega o ID da sala da URL (se for convidado) ou das configura√ß√µes (se for dono)
            const urlParams = new URLSearchParams(window.location.search);
            const urlRoomId = urlParams.get('meetingId');
            const roomName = urlRoomId || settings.meetingRoomId || "ZandrixPublicLobby";
            
            // Definir Usu√°rio
            // Pega do input local (que pode ter sido editado pelo funcion√°rio) ou usa o padr√£o
            const myName = document.getElementById('meet-display-name').value;
            const myAvatar = currentMeetingAvatar || settings.ownerPhoto || ""; 

            if (!myName) return showNotification("Por favor, digite seu nome para entrar.", "error");

            lobby.style.display = 'none';
            activeArea.style.display = 'block';
            container.innerHTML = ""; // Limpa anterior

            if (typeof JitsiMeetExternalAPI === 'undefined') {
                showNotification("Erro: O sistema de reuni√µes n√£o carregou. Verifique sua conex√£o.", "error");
                return;
            }

            if (jitsiApi) jitsiApi.dispose(); // Garante que n√£o tenha nada rodando antes
            const domain = 'meet.jit.si'; // Servidor Oficial (√önico que funciona r√°pido no GitHub)
            
            let safeRoomName = roomName.replace(/[^a-zA-Z0-9]/g, '');
            if (!safeRoomName) safeRoomName = "ZandrixRoom" + Math.floor(Math.random() * 10000);

            const options = {
                roomName: safeRoomName,
                width: '100%',
                height: 600,
                parentNode: container,
                lang: 'pt',
                userInfo: {
                    displayName: myName
                },
                configOverwrite: { 
                    prejoinPageEnabled: false, // Tenta entrar direto
                    startWithAudioMuted: true, 
                    startWithVideoMuted: true
                },
                interfaceConfigOverwrite: { SHOW_JITSI_WATERMARK: false }
            };

            try {
                jitsiApi = new JitsiMeetExternalAPI(domain, options);
                
                if(myAvatar) {
                    setTimeout(() => {
                        try { jitsiApi.executeCommand('avatarUrl', myAvatar); } catch(e){}
                    }, 2000);
                }
            } catch (e) {
                showNotification("Erro ao iniciar a reuni√£o.", "error");
            }

        }

        function toggleScreenShare() {
            if (jitsiApi) {
                jitsiApi.executeCommand('toggleShareScreen');
            }
        }

        function leaveMeeting() {
            if (jitsiApi) jitsiApi.dispose();
            document.getElementById('meeting-active-area').style.display = 'none';
            document.getElementById('meeting-lobby').style.display = 'block';
            document.getElementById('jitsi-container').innerHTML = '';
        }

        // --- L√≥gica de Contratos (NOVO) ---
        function generateContract() {
            const client = document.getElementById('ctr-client').value;
            const doc = document.getElementById('ctr-doc').value;
            const service = document.getElementById('ctr-service').value;
            const value = document.getElementById('ctr-value').value;
            const entry = document.getElementById('ctr-entry').value;
            const deadline = document.getElementById('ctr-deadline').value;
            const settings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};
            const myName = settings.name || "Zandrix Agency";
            const myOwner = settings.ownerName || "Representante Legal";

            if(!client || !value) return showNotification("Preencha os dados principais.", "error");

            const win = window.open('', '', 'width=900,height=800');
            win.document.write(`
                <html><head><title>Contrato de Presta√ß√£o de Servi√ßos</title>
                <style>
                    body { font-family: 'Times New Roman', serif; padding: 40px; max-width: 800px; margin: 0 auto; line-height: 1.6; }
                    h1 { text-align: center; text-transform: uppercase; font-size: 18px; margin-bottom: 30px; }
                    h2 { font-size: 14px; text-transform: uppercase; margin-top: 20px; }
                    p { text-align: justify; margin-bottom: 10px; }
                    .signature-box { margin-top: 50px; display: flex; justify-content: space-between; }
                    .sig { width: 45%; border-top: 1px solid #000; text-align: center; padding-top: 10px; }
                </style>
                </head><body>
                <h1>CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS DE DESENVOLVIMENTO WEB</h1>
                
                <p><strong>CONTRATADA:</strong> ${myName}, representada por ${myOwner}.</p>
                <p><strong>CONTRATANTE:</strong> ${client}, portador(a) do CPF/CNPJ n¬∫ ${doc}.</p>

                <h2>CL√ÅUSULA 1¬™ - DO OBJETO</h2>
                <p>O presente contrato tem como objeto a presta√ß√£o de servi√ßos de desenvolvimento web, especificamente: <strong>${service}</strong>.</p>

                <h2>CL√ÅUSULA 2¬™ - DO PRAZO</h2>
                <p>A CONTRATADA compromete-se a entregar o servi√ßo descrito na Cl√°usula 1¬™ no prazo estimado de <strong>${deadline} dias √∫teis</strong>, contados a partir do recebimento de todo o material necess√°rio (textos, imagens, logotipos) por parte da CONTRATANTE.</p>

                <h2>CL√ÅUSULA 3¬™ - DO VALOR E FORMA DE PAGAMENTO</h2>
                <p>Pelos servi√ßos prestados, a CONTRATANTE pagar√° √† CONTRATADA o valor total de <strong>R$ ${value}</strong>.</p>
                <p>O pagamento ser√° realizado da seguinte forma: uma entrada de <strong>R$ ${entry}</strong> na assinatura deste contrato e o restante na entrega do projeto.</p>

                <h2>CL√ÅUSULA 4¬™ - DAS OBRIGA√á√ïES</h2>
                <p>A CONTRATADA dever√° entregar o projeto funcional e sem erros. A CONTRATANTE dever√° fornecer as informa√ß√µes necess√°rias e realizar os pagamentos nas datas acordadas.</p>

                <h2>CL√ÅUSULA 5¬™ - DO FORO</h2>
                <p>Fica eleito o foro da comarca local para dirimir quaisquer d√∫vidas oriundas deste contrato.</p>

                <p style="text-align: center; margin-top: 40px;">Local e Data: ______________________, ${new Date().toLocaleDateString()}</p>

                <div class="signature-box">
                    <div class="sig">
                        <strong>${myName}</strong><br>CONTRATADA
                    </div>
                    <div class="sig">
                        <strong>${client}</strong><br>CONTRATANTE
                    </div>
                </div>
                
                <script>window.print();<\/script>
                </body></html>
            `);
        }

        // --- L√≥gica de Projetos (NOVO) ---
        let projects = JSON.parse(localStorage.getItem('zandrix_projects')) || [];

        function loadProjects() {
            const list = document.getElementById('projects-list');
            list.innerHTML = '';
            
            let activeCount = 0;
            let devCount = 0;

            projects.forEach(p => {
                if(p.status !== 'done') activeCount++;
                if(p.status === 'dev') devCount++;

                const li = document.createElement('li');
                let badgeClass = 'status-pending';
                let badgeText = 'Pendente';
                
                if(p.status === 'dev') { badgeClass = 'status-dev'; badgeText = 'Em Dev'; }
                if(p.status === 'done') { badgeClass = 'status-done'; badgeText = 'Conclu√≠do'; }

                li.innerHTML = `
                    <div style="flex:1">
                        <div style="font-weight:bold; color:white;">${p.client} <span style="font-weight:normal; color:#888; font-size:12px;">(${p.type})</span></div>
                        <div style="font-size:12px; color:#aaa;">Prazo: ${p.deadline ? new Date(p.deadline).toLocaleDateString() : 'Sem data'} | Valor: R$ ${parseFloat(p.value).toFixed(2)}</div>
                    </div>
                    <div style="display:flex; align-items:center; gap: 10px;">
                        <span class="status-badge ${badgeClass}">${badgeText}</span>
                        <button onclick="deleteProject(${p.id})" style="background:none; border:none; cursor:pointer;">üóëÔ∏è</button>
                    </div>
                `;
                list.appendChild(li);
            });

            document.getElementById('active-projects-count').innerText = activeCount;
            document.getElementById('dev-projects-count').innerText = devCount;
        }

        function addProject() {
            const client = document.getElementById('proj-client').value;
            const type = document.getElementById('proj-name').value;
            const value = document.getElementById('proj-value').value;
            const deadline = document.getElementById('proj-deadline').value;
            const status = document.getElementById('proj-status').value;

            if(client && value) {
                projects.push({
                    id: Date.now(),
                    client, type, value, deadline, status
                });
                localStorage.setItem('zandrix_projects', JSON.stringify(projects));
                
                // Limpar campos
                document.getElementById('proj-client').value = '';
                document.getElementById('proj-name').value = '';
                document.getElementById('proj-value').value = '';
                
                loadProjects();
                showNotification("Projeto adicionado!", "success");
            } else {
                showNotification("Preencha nome do cliente e valor.", "error");
            }
        }

        function deleteProject(id) {
            if(confirm("Remover este projeto?")) {
                projects = projects.filter(p => p.id !== id);
                localStorage.setItem('zandrix_projects', JSON.stringify(projects));
                loadProjects();
            }
        }

        // --- L√≥gica de Checklist (NOVO) ---
        const defaultChecklist = [
            "Verificar Responsividade (Mobile/Tablet)",
            "Testar Formul√°rio de Contato",
            "Instalar Certificado SSL (Cadeado)",
            "Configurar Favicon (√çcone da aba)",
            "Otimizar Imagens (TinyPNG)",
            "Verificar Links Quebrados",
            "Configurar SEO (T√≠tulo e Descri√ß√£o)",
            "Testar Bot√£o do WhatsApp",
            "Backup Inicial Realizado"
        ];
        let checklistState = JSON.parse(localStorage.getItem('zandrix_checklist')) || {};

        function loadChecklist() {
            const container = document.getElementById('checklist-container');
            container.innerHTML = '';
            
            defaultChecklist.forEach((item, index) => {
                const isChecked = checklistState[index] ? 'checked' : '';
                const div = document.createElement('div');
                div.className = `checklist-item ${isChecked}`;
                div.onclick = () => toggleChecklist(index);
                div.innerHTML = `<div class="checklist-box"></div> ${item}`;
                container.appendChild(div);
            });
        }

        function toggleChecklist(index) {
            checklistState[index] = !checklistState[index];
            localStorage.setItem('zandrix_checklist', JSON.stringify(checklistState));
            loadChecklist();
        }

        function resetChecklist() {
            if(confirm("Limpar todas as marca√ß√µes?")) {
                checklistState = {};
                localStorage.setItem('zandrix_checklist', JSON.stringify(checklistState));
                loadChecklist();
            }
        }

        // --- L√≥gica de Configura√ß√µes ---
        function loadSettings() {
            let settings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};
            let needsSave = false;
            
            // Corre√ß√£o para acesso via Link (Mobile/Outros dispositivos)
            // Adota o token da URL como v√°lido para este dispositivo se estiver acessando via link
            const urlParams = new URLSearchParams(window.location.search);
            const mode = urlParams.get('mode');
            const urlToken = urlParams.get('token');

            if (mode === 'employee' && urlToken && !settings.employeeToken) {
                settings.employeeToken = urlToken;
                needsSave = true;
            } else if (mode === 'socio' && urlToken && !settings.socioToken) {
                settings.socioToken = urlToken;
                needsSave = true;
            }

            if (!settings.employeeToken) {
                settings.employeeToken = 'emp_' + Math.random().toString(36).substring(2, 15);
                needsSave = true;
            }
            if (!settings.socioToken) {
                settings.socioToken = 'soc_' + Math.random().toString(36).substring(2, 15);
                needsSave = true;
            }

            if (needsSave) {
                localStorage.setItem('zandrix_settings', JSON.stringify(settings));
            }

            // Agora, preenche o formul√°rio com o objeto de configura√ß√µes garantido
            document.getElementById('conf-name').value = settings.name || 'Zandrix';
            document.getElementById('conf-insta').value = settings.insta || '';
            document.getElementById('conf-whats').value = settings.whats || '';
            document.getElementById('conf-goal').value = settings.goal || '';
            document.getElementById('conf-owner-name').value = settings.ownerName || '';
            document.getElementById('conf-token').value = settings.employeeToken;
            document.getElementById('conf-socio-token').value = settings.socioToken;
            
            applySettings(settings);
        }

        function saveSettings() {
            const name = document.getElementById('conf-name').value;
            const insta = document.getElementById('conf-insta').value;
            const whats = document.getElementById('conf-whats').value;
            const goal = document.getElementById('conf-goal').value;
            const ownerName = document.getElementById('conf-owner-name').value;
            const token = document.getElementById('conf-token').value;
            const socioToken = document.getElementById('conf-socio-token').value;
            const logoInput = document.getElementById('conf-logo-upload');
            const bannerInput = document.getElementById('conf-banner-upload');
            const ownerInput = document.getElementById('conf-owner-photo');
            
            const currentSettings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};

            // Fun√ß√£o auxiliar para ler arquivo
            const readFile = (file) => {
                return new Promise((resolve) => {
                    if (!file) return resolve(null);
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(file);
                });
            };

            Promise.all([
                readFile(logoInput.files[0]),
                readFile(bannerInput.files[0]),
                readFile(ownerInput.files[0])
            ]).then(([newLogo, newBanner, newOwnerPhoto]) => {
                const settings = {
                    name: name,
                    insta: insta,
                    whats: whats,
                    goal: goal,
                    ownerName: ownerName,
                    employeeToken: token,
                    socioToken: socioToken,
                    logo: newLogo || currentSettings.logo,
                    banner: newBanner || currentSettings.banner,
                    ownerPhoto: newOwnerPhoto || currentSettings.ownerPhoto
                };
                localStorage.setItem('zandrix_settings', JSON.stringify(settings));
                applySettings(settings);
                showNotification("Dados salvos com sucesso!", 'success');
            });
        }

        function generateNewToken(notify = true) {
            const newToken = 'emp_' + Math.random().toString(36).substring(2, 15);
            document.getElementById('conf-token').value = newToken;
            
            // Salva imediatamente para garantir persist√™ncia
            const currentSettings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};
            currentSettings.employeeToken = newToken;
            localStorage.setItem('zandrix_settings', JSON.stringify(currentSettings));
            
            if(notify) showNotification("Novo link gerado! O link anterior foi invalidado.", "success");
        }

        function generateNewSocioToken(notify = true) {
            const newToken = 'soc_' + Math.random().toString(36).substring(2, 15);
            document.getElementById('conf-socio-token').value = newToken;
            
            // Salva imediatamente para garantir persist√™ncia
            const currentSettings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};
            currentSettings.socioToken = newToken;
            localStorage.setItem('zandrix_settings', JSON.stringify(currentSettings));
            
            if(notify) showNotification("Novo link de S√≥cio gerado! O link anterior foi invalidado.", "success");
        }

        function removeImages() {
            const currentSettings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};
            currentSettings.logo = null;
            currentSettings.banner = null;
            currentSettings.ownerPhoto = null;
            localStorage.setItem('zandrix_settings', JSON.stringify(currentSettings));
            applySettings(currentSettings);
            document.getElementById('conf-logo-upload').value = '';
            document.getElementById('conf-banner-upload').value = '';
            document.getElementById('conf-owner-photo').value = '';
            showNotification("Imagens removidas!", 'success');
        }

        function applySettings(data) {
            const socioBrandDisplay = document.getElementById('socio-brand-display');
            if(data.name) {
                document.getElementById('brand-display').innerText = data.name;
                socioBrandDisplay.innerHTML = `${data.name} <br><span style="font-size:12px; color:white;">√Årea de S√≥cio</span>`;
            }
            if(data.insta) document.getElementById('header-insta').innerText = data.insta;
            if(data.whats) document.getElementById('header-whats').innerText = data.whats;
            
            const sidebarLogo = document.getElementById('sidebar-logo');
            const sidebarBanner = document.getElementById('sidebar-banner');
            const socioSidebarLogo = document.getElementById('socio-sidebar-logo');
            const socioSidebarBanner = document.getElementById('socio-sidebar-banner');
            const socioOwnerArea = document.getElementById('socio-owner-display-area');
            const socioOwnerPhoto = document.getElementById('socio-sidebar-owner-photo');
            const socioOwnerName = document.getElementById('socio-sidebar-owner-name');

            const sidebarOwnerArea = document.getElementById('owner-display-area');
            const sidebarOwnerPhoto = document.getElementById('sidebar-owner-photo');
            const sidebarOwnerName = document.getElementById('sidebar-owner-name');
            const previewLogo = document.getElementById('settings-logo-preview');
            const previewBanner = document.getElementById('settings-banner-preview');
            const previewOwner = document.getElementById('settings-owner-preview');
            
            if(data.logo) {
                sidebarLogo.src = data.logo;
                socioSidebarLogo.src = data.logo;
                sidebarLogo.style.display = 'block';
                socioSidebarLogo.style.display = 'block';
                previewLogo.src = data.logo;
                previewLogo.style.display = 'block';
            } else {
                sidebarLogo.style.display = 'none';
                socioSidebarLogo.style.display = 'none';
                previewLogo.style.display = 'none';
            }

            if(data.banner) {
                sidebarBanner.style.backgroundImage = `url(${data.banner})`;
                socioSidebarBanner.style.backgroundImage = `url(${data.banner})`;
                previewBanner.style.backgroundImage = `url(${data.banner})`;
                previewBanner.style.display = 'block';
            } else {
                sidebarBanner.style.backgroundImage = 'none';
                socioSidebarBanner.style.backgroundImage = 'none';
                previewBanner.style.display = 'none';
            }

            // L√≥gica do Dono
            if(data.ownerName || data.ownerPhoto) {
                sidebarOwnerArea.style.display = 'block';
                socioOwnerArea.style.display = 'block';
                sidebarOwnerName.innerText = data.ownerName || 'CEO';
                socioOwnerName.innerText = data.ownerName || 'CEO';
                if(data.ownerPhoto) {
                    sidebarOwnerPhoto.src = data.ownerPhoto;
                    socioOwnerPhoto.src = data.ownerPhoto;
                    sidebarOwnerPhoto.style.display = 'inline-block';
                    socioOwnerPhoto.style.display = 'inline-block';
                    previewOwner.src = data.ownerPhoto;
                    previewOwner.style.display = 'block';
                } else {
                    sidebarOwnerPhoto.style.display = 'none';
                    socioOwnerPhoto.style.display = 'none';
                }
            } else {
                sidebarOwnerArea.style.display = 'none';
                socioOwnerArea.style.display = 'none';
            }
        }

        // --- L√≥gica da Calculadora ---
        function calcInput(val) {
            document.getElementById('calc-display').value += val;
        }
        function clearCalc() {
            document.getElementById('calc-display').value = '';
        }
        function backspaceCalc() {
            let val = document.getElementById('calc-display').value;
            document.getElementById('calc-display').value = val.slice(0, -1);
        }
        function calculate() {
            try {
                const result = eval(document.getElementById('calc-display').value);
                document.getElementById('calc-display').value = result;
            } catch (e) {
                showNotification("Erro na conta", 'error');
            }
        }

        // --- L√≥gica de Modo Funcion√°rio ---
        function checkMode() {
            const urlParams = new URLSearchParams(window.location.search);
            const mode = urlParams.get('mode');
            const token = urlParams.get('token');
            const meetingId = urlParams.get('meetingId'); // Captura ID da reuni√£o
            const settings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};

            // 1. Reset to Owner View (default)
            document.getElementById('owner-sidebar').style.display = 'flex';
            document.getElementById('employee-sidebar').style.display = 'none';
            document.getElementById('socio-sidebar').style.display = 'none';
            document.body.classList.remove('role-socio'); // Reset role class
            document.querySelectorAll('.section').forEach(s => { s.style.display = '' }); // Reset display property
            document.getElementById('meeting-admin-panel').style.display = 'block'; // Show admin panel by default

            // Se for o dono (sem parametros de modo), preenche o nome automaticamente
            if (!mode && !meetingId) {
                document.getElementById('meet-display-name').value = settings.ownerName || "";
                if(settings.ownerPhoto) {
                    document.getElementById('meet-preview-avatar').src = settings.ownerPhoto;
                    currentMeetingAvatar = settings.ownerPhoto;
                }
            }

            // Se for Acesso APENAS para Reuni√£o (Link de Convidado)
            if (meetingId && !mode) {
                // Esconde tudo, mostra apenas a reuni√£o
                document.getElementById('owner-sidebar').style.display = 'none';
                document.querySelectorAll('.section').forEach(s => { s.style.display = 'none' });
                document.getElementById('meetings').style.display = 'block';
                document.getElementById('meeting-admin-panel').style.display = 'none'; // Esconde painel de admin
                document.getElementById('mobile-menu-btn').style.display = 'none';
                return; // Para a execu√ß√£o aqui
            }

            // 2. Apply restrictions based on mode
            if (mode === 'employee') { // MODO FUNCION√ÅRIO
                if (!settings.employeeToken || token !== settings.employeeToken) {
                    document.body.innerHTML = `<div style="display:flex;justify-content:center;align-items:center;height:100vh;flex-direction:column;color:white;background:black;">
                        <h1 style="color:#ff4444">Acesso Negado</h1>
                        <p>Este link de funcion√°rio expirou ou √© inv√°lido.</p>
                        <button onclick="localStorage.removeItem('zandrix_settings'); location.reload();" style="margin-top:15px; padding:10px; background:#333; color:white; border:none; cursor:pointer;">üîÑ Atualizar Acesso (Limpar Cache)</button>
                        <a href="${window.location.href.split('?')[0]}" style="color:var(--primary-color);margin-top:20px;">Voltar ao In√≠cio</a>
                    </div>`;
                    return;
                }
                document.getElementById('owner-sidebar').style.display = 'none';
                document.getElementById('employee-sidebar').style.display = 'flex';
                // Hide forbidden sections
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('financial').style.display = 'none';
                document.getElementById('settings').style.display = 'none';
                document.getElementById('meeting-admin-panel').style.display = 'none'; // Hide admin panel
                showSection('employee-dashboard');

            } else if (mode === 'socio') { // MODO S√ìCIO
                if (!settings.socioToken || token !== settings.socioToken) {
                    document.body.innerHTML = `<div style="display:flex;justify-content:center;align-items:center;height:100vh;flex-direction:column;color:white;background:black;">
                        <h1 style="color:#ff4444">Acesso Negado</h1>
                        <p>Este link de s√≥cio expirou ou √© inv√°lido.</p>
                        <button onclick="localStorage.removeItem('zandrix_settings'); location.reload();" style="margin-top:15px; padding:10px; background:#333; color:white; border:none; cursor:pointer;">üîÑ Atualizar Acesso (Limpar Cache)</button>
                        <a href="${window.location.href.split('?')[0]}" style="color:var(--primary-color);margin-top:20px;">Voltar ao In√≠cio</a>
                    </div>`;
                    return;
                }
                document.getElementById('owner-sidebar').style.display = 'none';
                document.getElementById('socio-sidebar').style.display = 'flex';
                document.body.classList.add('role-socio'); // Add role class
                // Hide forbidden sections
                document.getElementById('settings').style.display = 'none';
                document.getElementById('employee-dashboard').style.display = 'none';
                document.getElementById('meeting-admin-panel').style.display = 'none'; // Hide admin panel
                showSection('dashboard');

            } else { // MODO DONO (PADR√ÉO)
                document.getElementById('employee-dashboard').style.display = 'none';
                showSection('dashboard');
            }
        }

        function copyEmployeeLink() {
            const settings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};
            const token = settings.employeeToken || '';
            const url = window.location.href.split('?')[0] + '?mode=employee&token=' + token;
            navigator.clipboard.writeText(url).then(() => {
                showNotification("Link de funcion√°rio copiado!", "success");
            });
        }

        function copySocioLink() {
            const settings = JSON.parse(localStorage.getItem('zandrix_settings')) || {};
            const token = settings.socioToken || '';
            const url = window.location.href.split('?')[0] + '?mode=socio&token=' + token;
            navigator.clipboard.writeText(url).then(() => {
                showNotification("Link de s√≥cio copiado!", "success");
            });
        }

        // --- Importa√ß√£o e Exporta√ß√£o de Dados ---
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (confirm("Isso ir√° substituir TODOS os dados atuais por este backup. Deseja continuar?")) {
                        if (data.sales) localStorage.setItem('zandrix_sales', JSON.stringify(data.sales));
                        if (data.expenses) localStorage.setItem('zandrix_expenses', JSON.stringify(data.expenses));
                        if (data.notes) localStorage.setItem('zandrix_notes_v2', JSON.stringify(data.notes));
                        if (data.projects) localStorage.setItem('zandrix_projects', JSON.stringify(data.projects));
                        if (data.renewals) localStorage.setItem('zandrix_renewals', JSON.stringify(data.renewals));
                        if (data.settings) localStorage.setItem('zandrix_settings', JSON.stringify(data.settings));

                        showNotification("Dados importados! Recarregando o sistema...", "success");
                        setTimeout(() => window.location.reload(), 1500);
                    }
                } catch (err) {
                    showNotification("Erro: O arquivo de backup √© inv√°lido ou est√° corrompido.", "error");
                }
            };
            reader.readAsText(file);
            // Reset file input to allow importing the same file again
            event.target.value = '';
        }

        // --- Inicializa√ß√£o ---
        window.onload = function() {
            updateDashboard();
            updateExpensesList();
            loadNotes();
            loadProjects();
            loadRenewals();
            loadChecklist();
            loadClients();
            loadMeetingSettings();
            loadSettings();
            initParticles();
            checkMode(); // Verifica se √© funcion√°rio
        };

        // --- Sistema de Part√≠culas ---
        function initParticles() {
            const canvas = document.getElementById('particles-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const logoImg = new Image();
            logoImg.src = 'https://i.imgur.com/w28Wu0f.png';

            let particles = [];
            const particleCount = 50;

            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    speed: Math.random() * 1 + 0.5,
                    size: Math.random() * 30 + 20,
                    opacity: Math.random() * 0.5 + 0.1
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                if (logoImg.complete) {
                    particles.forEach(p => {
                        ctx.globalAlpha = p.opacity;
                        ctx.drawImage(logoImg, p.x, p.y, p.size, p.size);

                        p.y -= p.speed;
                        if (p.y < -50) {
                            p.y = canvas.height;
                        p.x = Math.random() * canvas.width;
                    }
                });
                    ctx.globalAlpha = 1.0;
                }

                requestAnimationFrame(animate);
            }
            animate();
            
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }

        // --- Sistema de Notifica√ß√µes ---
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.innerHTML = `
                <div style="flex: 1;">${message}</div>
                <button onclick="this.parentElement.remove()" style="background:none; border:none; color:#888; cursor:pointer; font-size:16px;">&times;</button>
            `;
            
            container.appendChild(notif);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notif.style.animation = 'slideOut 0.5s ease-in forwards';
                setTimeout(() => notif.remove(), 500);
            }, 5000);
        }

        function exportData() {
            const allData = {
                sales: JSON.parse(localStorage.getItem('zandrix_sales')) || [],
                expenses: JSON.parse(localStorage.getItem('zandrix_expenses')) || [],
                notes: JSON.parse(localStorage.getItem('zandrix_notes_v2')) || [],
                projects: JSON.parse(localStorage.getItem('zandrix_projects')) || [],
                clients: JSON.parse(localStorage.getItem('zandrix_clients')) || [],
                renewals: JSON.parse(localStorage.getItem('zandrix_renewals')) || [],
                settings: JSON.parse(localStorage.getItem('zandrix_settings')) || {}
            };

            const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `zandrix_backup_${new Date().toISOString().split('T')[0]}.json`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification("Backup completo exportado com sucesso!", "success");
        }

        // --- Controle de Rolagem (Setinhas) ---
        function scrollPage(direction) {
            // Encontrar a sidebar vis√≠vel para rolar o menu
            const sidebars = document.querySelectorAll('.sidebar');
            let activeSidebar = null;
            sidebars.forEach(s => {
                if (window.getComputedStyle(s).display !== 'none') activeSidebar = s;
            });

            const amount = 100;
            if (activeSidebar && direction === 'up') activeSidebar.scrollBy({ top: -amount, behavior: 'smooth' });
            else if (activeSidebar) activeSidebar.scrollBy({ top: amount, behavior: 'smooth' });
        }

    </script>
</body>



</html>